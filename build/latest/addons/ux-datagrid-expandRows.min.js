/*!
* ux-angularjs-datagrid v.1.2.0
* (c) 2015, Obogo
* https://github.com/obogo/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


exports.datagrid.events.COLLAPSE_ROW="datagrid:collapseRow",exports.datagrid.events.EXPAND_ROW="datagrid:expandRow",exports.datagrid.events.TOGGLE_ROW="datagrid:toggleRow",exports.datagrid.events.ROW_TRANSITION_COMPLETE="datagrid:rowTransitionComplete",exports.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS="datagrid:collapseAllExpandedRows",exports.datagrid.options.expandRows=[],exports.datagrid.options.expandRows.autoClose=!0,exports.datagrid.options.expandRows.scrollOnExpand=!0,angular.module("ux").factory("expandRows",function(){return["inst",function(a){function b(b){return s="number"==typeof b?b:a.getNormalizedIndex(b,s)}function c(b){if(b.template=b.template||a.templateModel.defaultName,!b.cls&&!b.style&&!b.swap)throw new Error("expandRows will not work without an cls|style|swap property");u[b.template]=b}function d(){ux.each(a.options.expandRows,c)}function e(a){var c=b(a);return v[c]?x.opened:x.closed}function f(a){e(a)===x.closed?g(a):h(a)}function g(c){var d=b(c);if(e(d)===x.closed){if(a.options.expandRows.autoClose&&w)return;w=!0,i([d]),k(d,x.opened)}}function h(a){var c=b(a);e(c)===x.opened&&k(c,x.closed)}function i(b){a.options.expandRows.autoClose&&j(b)}function j(b,c){exports.each(v,function(d,e){var f=parseInt(e,10);(!b||a.rowsLength>f&&-1===b.indexOf(f))&&(c?delete v[e]:h(f))})}function k(b,c){var d,e,f,g=a.templateModel.getTemplate(a.data[b]);if(!u[g.name])throw new Error("unable to toggle template. cls for template '"+g.name+"' was not set.");if(d=a.getExistingRow(b),!d||!d.scope())return void delete v[b];if(d.scope().$state=c,e=u[g.name],e.transition!==!1&&d[0].addEventListener(B,n),e.style&&(e.reverse||(e.reverse=l(d,e.style)),d.css(c===x.opened?e.style:e.reverse)),e.swap&&e.state!==c?(f=u[e.swap],a.templateModel.setTemplate(b,e.swap,[f.cls]),d=a.getRowElm(b)):e.cls&&(d[c===x.opened?"addClass":"removeClass"](e.cls),d.addClass("animating")),e.transition===!1){var h={target:d[0],index:b,state:c};a.options.chunks.detachDom?setTimeout(function(){n(h)},0):n(h)}else w=!1}function l(a,b){var c={elm:a,style:b,reverse:{}};return ux.each(b,m,c),c.reverse}function m(a,b,c,d){d.reverse[b]=d.elm.css(b)}function n(b){var c,d,e,f;if(Object.prototype.hasOwnProperty.apply(b,["index"])?(c=a.getRowElm(b.index),e=b.index,f=b.state):c=angular.element(b.target),d=c.scope(),f&&d?(d.$index=e,d.$state=f):d&&(e=d.$index,f=d.$state),c[0].removeEventListener(B,n),c.removeClass("animating"),f===x.opened){if(v[e]={index:e,height:parseInt(c[0].offsetHeight||0,10)},isNaN(v[e].height))throw new Error("Invalid Height")}else delete v[e];d&&a.safeDigest(d),a.updateHeights(e),clearTimeout(r),r=setTimeout(function(){clearTimeout(r),a.options.expandRows.scrollOnExpand&&a.scrollModel.scrollIntoView(e,!0),a.dispatch(exports.datagrid.events.ROW_TRANSITION_COMPLETE),w=!1,a.options.expandRows.scrollOnExpand&&a.flow.add(function(){f===x.opened&&e===a.data.length-1&&a.getViewportHeight()<a.getContentHeight()&&a.scrollModel.scrollToBottom(!0)},[],0)},0)}function o(a){var c=b(a);return!!v[c]}function p(a){var c=b(a);return v[c]?(t.log("	expandRow %s to height %s",c,v[c].height),v[c].height):y(a)}function q(){t=null,u=null,v=null,x=null}var r,s,t=exports.logWrapper("expandRows",{},"green",a.dispatch),u={},v={},w=!1,x={opened:"opened",closed:"closed"},y=a.templateModel.getTemplateHeight,z=document.createElement("div").style,A=function(){for(var a,b="t,webkitT,MozT,msT,OT".split(","),c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in z)return b[c].substr(0,b[c].length-1);return!1}(),B=function(){if(A===!1)return!1;var a={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"};return a[A]}();return z=null,a.templateModel.getTemplateHeight=p,t.states=x,t.getIndex=b,t.toggle=f,t.expand=g,t.collapse=h,t.isExpanded=o,t.destroy=q,a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_READY,d)),a.unwatchers.push(a.scope.$on(exports.datagrid.events.EXPAND_ROW,function(a,b){t.expand(b)})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.COLLAPSE_ROW,function(a,b){t.collapse(b)})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.TOGGLE_ROW,function(a,b){t.toggle(b)})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_ROW_COMPILE,function(b,c,d){if(v[c.$index]){var e=a.templateModel.getTemplate(a.data[c.$index]),f=u[e.name];d[0].classList.add(f.cls)}})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.COLLAPSE_ALL_EXPANDED_ROWS,function(a,b){j(null,b)})),exports.datagrid.events.ON_BEFORE_TOGGLE_SORT&&a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_BEFORE_TOGGLE_SORT,function(a){j()})),a.unwatchers.push(a.scope.$on(exports.datagrid.events.ON_BEFORE_DATA_CHANGE,function(a){j(null,!0)})),a.expandRows=t,a}]});
//# sourceMappingURL=ux-datagrid-expandRows.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
